<div class="bel-modal-overlay" (click)="closeModal()">
  <div class="bel-modal-container" (click)="$event.stopPropagation()">

    <!-- Header du modal -->
    <header class="bel-modal-header">
      <h2>üìù Cr√©er une Publication</h2>
      <button (click)="closeModal()" class="bel-modal-close" title="Fermer">
        √ó
      </button>
    </header>

    <form [formGroup]="postForm" (ngSubmit)="createPost()" class="bel-post-form">

      <div class="bel-form-section">
        <label class="bel-form-label">üåç Visibilit√© de la publication</label>
        <div class="bel-visibility-options">
          <label class="bel-radio-option">
            <input
              type="radio"
              formControlName="visibility"
              value="national"
              class="bel-radio-input">
              <span class="bel-radio-custom"></span>
              <span class="bel-radio-content">
                <strong>üè† National</strong>
                <small>Visible uniquement par votre communaut√© ‚Ä¢ Expire dans 48h</small>
              </span>
            </label>

            <label class="bel-radio-option">
              <input
                type="radio"
                formControlName="visibility"
                value="international"
                class="bel-radio-input">
                <span class="bel-radio-custom"></span>
                <span class="bel-radio-content">
                  <strong>üåç International</strong>
                  <small>Visible par toutes les communaut√©s ‚Ä¢ Expire dans 72h</small>
                </span>
              </label>
            </div>
          </div>

          <div class="bel-form-section">
            <label for="postContent" class="bel-form-label">
              üí¨ Contenu de la publication *
            </label>
            <textarea
              id="postContent"
              formControlName="content"
              placeholder="Partagez une information, une annonce, ou une actualit√© avec la communaut√©..."
              rows="6"
              maxlength="1000"
            class="bel-form-textarea"></textarea>

            <div class="bel-textarea-info">
              <span class="bel-char-count">
                {{ postForm.get('content')?.value?.length || 0 }}/1000 caract√®res
              </span>
              <small>Les publications doivent respecter les r√®gles de la communaut√©</small>
            </div>

            @if (postForm.get('content')?.errors?.['required'] && postForm.get('content')?.touched) {
              <div
                class="bel-error-message">
                ‚ö†Ô∏è Le contenu de la publication est obligatoire
              </div>
            }
          </div>

          <!-- Upload d'images -->
          <div class="bel-form-section">
            <label class="bel-form-label">üñºÔ∏è Images (optionnel)</label>

            <div class="bel-images-upload">
              <div class="bel-images-preview">
                @for (image of imagePreviews; track image; let i = $index) {
                  <div class="bel-image-preview">
                    <img [src]="image" alt="Pr√©visualisation" class="bel-preview-img">
                    <button type="button" (click)="removeImage(i)" class="bel-remove-image">
                      √ó
                    </button>
                  </div>
                }

                @if (imagePreviews.length < 4) {
                  <div class="bel-image-upload-btn" (click)="imageInput.click()">
                    <span class="bel-upload-icon">+</span>
                    <small>Ajouter une image</small>
                  </div>
                }
              </div>

              <input
                type="file"
                #imageInput
                (change)="onImageSelected($event)"
                accept="image/*"
                multiple
                class="bel-file-input">
              </div>

              <small>Maximum 4 images ‚Ä¢ Formats: JPG, PNG ‚Ä¢ 5MB max par image</small>
            </div>

            <!-- Aper√ßu de la dur√©e de vie -->
            <div class="bel-expiry-preview">
              <div class="bel-expiry-info">
                <span class="bel-expiry-icon">‚è∞</span>
                <div class="bel-expiry-details">
                  <strong>Dur√©e de vie</strong>
                  @if (postForm.get('visibility')?.value === 'national') {
                    <span>
                      Cette publication expirera dans <strong>48 heures</strong>
                    </span>
                  }
                  @if (postForm.get('visibility')?.value === 'international') {
                    <span>
                      Cette publication expirera dans <strong>72 heures</strong>
                    </span>
                  }
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="bel-modal-actions">
              <button type="button" (click)="closeModal()" class="bel-btn-cancel">
                Annuler
              </button>
              <button
                type="submit"
                class="bel-btn-primary"
                [disabled]="!postForm.valid || isLoading">
                @if (!isLoading) {
                  <span>
                    <span class="bel-btn-icon">üì®</span>
                    Publier
                  </span>
                }
                @if (isLoading) {
                  <span>
                    <span class="bel-btn-icon">‚è≥</span>
                    Publication...
                  </span>
                }
              </button>
            </div>

          </form>

        </div>
      </div>