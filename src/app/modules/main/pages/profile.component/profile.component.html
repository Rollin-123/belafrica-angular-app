<div class="bel-profile-container">

  <!-- Header avec bouton retour -->
  <header class="bel-profile-header">
    <div class="bel-profile-header-content">
      <button (click)="goBackToSettings()" class="bel-back-btn" title="Retour aux param√®tres">
        ‚Üê Retour
      </button>
      <h1>Mon Profil</h1>
    </div>
    <p>G√©rez vos informations personnelles</p>
  </header>

  @if (user) {
    <div class="bel-profile-avatar-section">
      <div class="bel-avatar-container">
        @if (user.avatar_url) {
          <img
            [src]="user.avatar_url"
            [alt]="user.pseudo || 'Utilisateur'"
            class="bel-avatar-image">
          } @else {
            <div class="bel-avatar-default">
              {{ getUserInitials() }}
            </div>
          }

          <div class="bel-avatar-actions">
            <input
              type="file"
              id="avatarInput"
              (change)="onAvatarSelected($event)"
              accept="image/*"
              class="bel-file-input">
              <label for="avatarInput" class="bel-avatar-upload-btn" title="Changer la photo">
                üì∑
              </label>
            </div>
          </div>

          <div class="bel-user-basic-info">
            <h2 class="bel-user-name">{{ user.pseudo }}</h2>
            <p class="bel-user-community">Communaut√© {{ user.community }}</p>
            <p class="bel-user-member-since">Membre depuis {{ getMemberSince() }}</p>
          </div>
        </div>

        <!-- Contenu Principal -->
        <main class="bel-profile-content">

          <!-- Mode √âdition -->
          @if (isEditing) {
            <div class="bel-edit-section">
              <div class="bel-edit-card">
                <h3>Modifier mon profil</h3>
                <form (ngSubmit)="saveProfile()" class="bel-edit-form">
                  <!-- Pseudo -->
                  <div class="bel-form-group">
                    <label for="pseudo">Pseudonyme *</label>
                    <input
                      type="text"
                      id="pseudo"
                      [(ngModel)]="editData.pseudo"
                      name="pseudo"
                      required
                      maxlength="30"
                      class="bel-form-input">
                      <small>Votre nom d'affichage sur la plateforme</small>
                    </div>

                    <!-- Bio -->
                    <div class="bel-form-group">
                      <label for="bio">Bio</label>
                      <textarea
                        id="bio"
                        [(ngModel)]="editData.bio"
                        name="bio"
                        rows="3"
                        maxlength="200"
                        placeholder="D√©crivez-vous en quelques mots..."
                      class="bel-form-textarea"></textarea>
                      <small>{{ editData.bio?.length || 0 }}/200 caract√®res</small>
                    </div>

                    <!-- Genre -->
                    <div class="bel-form-group">
                      <label for="gender">Genre</label>
                      <select
                        id="gender"
                        [(ngModel)]="editData.gender"
                        name="gender"
                        class="bel-form-select">
                        <option value="">S√©lectionnez...</option>
                        @for (gender of genders; track gender) {
                          <option [value]="gender.value">
                            {{ gender.label }}
                          </option>
                        }
                      </select>
                    </div>

                    <!-- Profession -->
                    <div class="bel-form-group">
                      <label for="profession">Profession</label>
                      <input
                        type="text"
                        id="profession"
                        [(ngModel)]="editData.profession"
                        name="profession"
                        placeholder="Votre m√©tier..."
                        class="bel-form-input">
                      </div>

                      <!-- Centres d'int√©r√™t -->
                      <div class="bel-form-group">
                        <label>Centres d'int√©r√™t</label>
                        <div class="bel-interests-container">
                          @for (interest of editData.interests; track interest) {
                            <div class="bel-interest-tag">
                              {{ interest }}
                              <button type="button" (click)="removeInterest(interest)" class="bel-interest-remove">
                                √ó
                              </button>
                            </div>
                          }
                          <input
                            type="text"
                            placeholder="Ajouter un int√©r√™t (Entr√©e pour valider)"
                            (keydown)="addInterest($event)"
                            class="bel-interest-input">
                          </div>
                          <small>Appuyez sur Entr√©e apr√®s chaque int√©r√™t</small>
                        </div>

                        <!-- Actions -->
                        <div class="bel-form-actions">
                          <button type="button" (click)="cancelEditing()" class="bel-btn-cancel" [disabled]="isLoading">
                            Annuler
                          </button>
                          <button type="submit" class="bel-btn-primary" [disabled]="isLoading">
                            {{ isLoading ? '‚è≥ Enregistrement...' : 'üíæ Enregistrer' }}
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                }

                <!-- Mode Consultation -->
                @if (!isEditing) {
                  <div class="bel-view-section">

                    <!-- Informations Personnelles -->
                    <div class="bel-info-card">
                      <div class="bel-card-header">
                        <h3>üìã Informations personnelles</h3>
                        <button (click)="startEditing()" class="bel-edit-btn" title="Modifier le profil">
                          Modifier
                        </button>
                      </div>
                      <div class="bel-info-grid">
                        <div class="bel-info-item">
                          <span class="bel-info-label">Pseudonyme:</span>
                          <span class="bel-info-value">{{ user.pseudo }}</span>
                        </div>

                        <div class="bel-info-item">
                          <span class="bel-info-label">Email:</span>
                          <span class="bel-info-value">{{ user.email || 'Non sp√©cifi√©' }}</span>
                        </div>
                        <div class="bel-info-item">
                          <span class="bel-info-label">Genre:</span>
                          @if (user.gender) {
                            <span class="bel-info-value">
                              {{ getGenderLabel(user.gender) }}
                            </span>
                          }
                        </div>

                        @if (user.profession) {
                          <div class="bel-info-item">
                            <span class="bel-info-label">Profession:</span>
                            <span class="bel-info-value">{{ user.profession }}</span>
                          </div>
                        }
                      </div>

                      <!-- Bio -->
                      @if (user.bio) {
                        <div class="bel-bio-section">
                          <h4>√Ä propos</h4>
                          <p class="bel-bio-text">{{ user.bio }}</p>
                        </div>
                      }

                      <!-- Centres d'int√©r√™t -->
                      @if (user.interests && user.interests.length > 0) {
                        <div class="bel-interests-section">
                          <h4>Centres d'int√©r√™t</h4>
                          <div class="bel-interests-list">
                            @for (interest of user.interests; track interest) {
                              <span class="bel-interest-badge">
                                {{ interest }}
                              </span>
                            }
                          </div>
                        </div>
                      }
                    </div>

                  </div>
                }

              </main>
            } @else {
              <!-- Message si pas d'utilisateur -->
              <div class="bel-no-user">
                <div class="bel-no-user-icon">üë§</div>
                <h3>Aucun utilisateur connect√©</h3>
                <p>Veuillez vous connecter pour voir votre profil</p>
              </div>
            }

          </div>